<!DOCTYPE html>
<html lang="cs">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">

        <meta name="description" content="Oficiální stránky PHP komunity">
        <meta name="keywords" content="PHP, komunita, programování">
        <meta name="author" content="http://pehapkari.cz">
        <meta name="robots" content="index, follow">

        <meta property="og:image" content="/images/php-square.png">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Konfigurační objekty v Nette">
    <meta property="og:description" content="Jak se poprat s předáním konfigurace službě z config.neon? A jak k tomu využít Nette DI?">
    <meta property="og:url" content="https://pehapkari.cz/blog/2017/01/30/konfiguracni-objekty-v-nette/">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Konfigurační objekty v Nette">
    <meta name="twitter:description" content="Jak se poprat s předáním konfigurace službě z config.neon? A jak k tomu využít Nette DI?">

        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="alternate" type="application/rss+xml" title="Péhápkaři.cz Blog RSS" href="/rss.xml">

        <link href="/assets/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

        <link href="/assets/bootstrap/bootstrap.min.css" rel="stylesheet" type="text/css">

    <link href="/assets/prism/prism.css" rel="stylesheet" type="text/css">
        <link href="/assets/css/style.css" rel="stylesheet" type="text/css">

        <link href="/favicon.ico" rel="shortcut icon">

        <title>Konfigurační objekty v Nette</title>
    </head>

    <body>
<header>
    <div class="container">
        <div class="hidden-xs">
            <a href="/"><img src="/assets/images/logo-header.svg?ver" alt="" height="50"></a>

            <nav class="top-navigation">
                <a href="/blog/" class="active">
                    <em class="fa fa-newspaper-o fa-fw"></em>
                    Blog
                </a>
                <a href="/mentori/">
                    <em class="fa fa-handshake-o fa-fw"></em>
                    Mentoři
                </a>
                <a href="/slovnicek/">
                    <em class="fa fa-language fa-fw"></em>
                    Slovníček
                </a>
                <a href="/knihovnicka/">
                    <em class="fa fa-book fa-fw"></em>
                    Knížky
                </a>

                    

                    <a href="https://github.com/pehapkari/pehapkari.cz/edit/master/source/_posts/2017/2017-01-30-konfiguracni-objekty-v-nette.md" class="hidden-sm">
                        <em class="fa fa-fw fa-pencil"></em>
                        Uprav
                    </a>
            </nav>
        </div>

        <div id="mobile-menu" class="row text-center hidden-md hidden-sm hidden-lg">
            <a href="/" class="col-xs-3">
                <em class="fa fa-home"></em>
                <br>
                Home
            </a>
            <a href="/blog/" class="col-xs-3 active">
                <em class="fa fa-book fa-fw"></em>
                <br>
                Blog
            </a>
            <a href="/mentori/" class="col-xs-3">
                <em class="fa fa-handshake-o fa-fw"></em>
                <br>
                Mentoři
            </a>
            <a href="/knihovnicka/" class="col-xs-3">
                <em class="fa fa-language fa-fw"></em>
                <br>
                Knížky
            </a>
        </div>
    </div>
</header>

    <div id="article">
        <div class="container">
            <h1 class="h2 text-center">Konfigurační objekty v Nette</h1>

            <div class="row text-center">
                <div class="col-md-12">
<div class="metadataLine">
        
        <p class="success">
            <strong><em class="fa fa-fw fa-check-square-o"></em>
                <a href="https://github.com/pehapkari/pehapkari.cz/tree/master/tests/Posts/Year2017/NetteConfigObjects">
                    Pokrytý testem
                </a>
            </strong>
        </p>

    <p>
        <em class="fa fa-clock-o fa-fw"></em>
        4 min

        |

        napsal
        <strong>Tomáš Jacík</strong>

        &ndash;

        <time datetime="2017-01-Mon">
            30. 1. 2017
        </time>

        |

        <em class="fa fa-fw fa-comments"></em>
        <a href="https://pehapkari.cz/blog/2017/01/30/konfiguracni-objekty-v-nette/#disqus_thread">X</a>
        komentářů
    </p>
</div>
                    <div id="reviewed_by">
                        <p>Prošlo revizí od:
                                Tomáš Votruba, 
                                Jáchym Toušek, 
                                Martin Zlámal
                        </p>
                    </div>
                </div>
            </div>

            <br>

            <div id="article-content">
                <p class="perex">Jak se poprat s předáním konfigurace službě z config.neon? A jak k tomu využít Nette DI?</p>

                

<h2 id="jak-se-to-bezne-delava"><a class="anchor" href="#jak-se-to-bezne-delava" aria-hidden="true"><span class="anchor-icon">#</span></a>Jak se to běžně dělává?</h2>
<p>Mějme hypotetickou třídu <code>InvoiceForm</code>. Formulář má vlastní šablonu, nemůžeme
tedy napsat pouhou továrnu, potřebujeme komponentu. A k ní továrnu. Navíc ale
chceme formuláři předat z <code>config.neon</code> nějaké výchozí hodnoty. Jak by takový
kód vypadal?</p>
<p><strong>Formulář</strong></p>
<pre><code class="language-php">declare(strict_types = 1);

namespace App\Forms;

use Nette\Application\UI\Control;
use Nette\Application\UI\Form;

final class InvoiceForm extends Control
{
    /**
     * @var array
     */
    private $config;

    public function __construct(array $config)
    {
        $this-&gt;config = $config;
    }

    protected function createComponentInvoiceForm(): Form
    {
        $form = new Form;

        $form-&gt;addText('maturity', 'Splatnost')
            -&gt;setDefaultValue($this-&gt;config['defaultMaturity']);

        return $form;
    }

    public function render()
    {
        $this-&gt;getTemplate()-&gt;render(__DIR__ . '/InvoiceForm.latte');
    }
}</code></pre>
<p><strong>Továrna</strong></p>
<pre><code class="language-php">declare(strict_types = 1);

namespace App\Forms;

final class InvoiceFormFactory
{
    /**
     * @var array
     */
    private $config;

    public function __construct(array $config)
    {
        $this-&gt;config = $config;
    }

    public function create(): InvoiceForm
    {
        return new InvoiceForm($this-&gt;config);
    }
}</code></pre>
<p><strong>Šablona</strong></p>
<pre><code class="language-smarty">&lt;form n:name="invoiceForm"&gt;
    ❴* naše vlastní vykreslení formuláře *❵
&lt;/form&gt;</code></pre>
<p>V <code>config.neon</code> pak musíme továrnu formuláře zaregistrovat a předat jí potřebné parametry.</p>
<pre><code class="language-yaml">parameters:
    invoicing:
        defaultMaturity: 7
        pdfDirectory: %appDir%/../invoices

services:
    - App\Forms\InvoiceFormFactory( %invoicing% )</code></pre>
<h2 id="jak-to-udelat-lepe"><a class="anchor" href="#jak-to-udelat-lepe" aria-hidden="true"><span class="anchor-icon">#</span></a>Jak to udělat lépe?</h2>
<p>Místo běžného pole si na konfiguraci vytvoříme objekt, který bude konfiguraci
našemu formuláři zprostředkovávat.</p>
<pre><code class="language-php">declare(strict_types = 1);

namespace App\Config;

use Nette\Utils\ArrayHash;

abstract class AbstractConfig extends ArrayHash
{
    public function __construct(array $arr)
    {
        foreach ($arr as $key =&gt; $value) {
            if (is_array($value)) {
                $this-&gt;$key = ArrayHash::from($value, TRUE);
            } else {
                $this-&gt;$key = $value;
            }
        }
    }
}</code></pre>
<p>Z tohoto objektu pak podědíme konfiguraci pro náš formulář. Můžeme také do třídy
přidat metody, které budou s naší konfigurací pracovat. Např. metodu <code>getPdfPath()</code>,
kterou později využijeme v třídě na generování PDF. Konfigurační třída tedy není
jen jednorázová, předáme její pomocí fakturační konfiguraci více službám.</p>
<pre><code class="language-php">declare(strict_types = 1);

namespace App\Config;

/**
 * @property int    $defaultMaturity
 * @property string $pdfDirectory
 */
final class InvoicingConfig extends AbstractConfig
{
    public function getPdfPath(int $invoiceId): string
    {
        return vsprintf('%s/%s.pdf', [$this-&gt;pdfDirectory, $invoiceId]);
    }
}</code></pre>
<p>Nyní můžeme třídu <code>InvoiceForm</code> upravit, aby nového konfiguračního objektu
využila. Všimněte si také metody <code>setDefaultValue()</code>. Díky <code>ArrayHash</code> nyní
můžeme ke konfiguraci přistupovat jako k objektu.</p>
<pre><code class="language-php">declare(strict_types = 1);

namespace App\Forms;

use App\Config\InvoicingConfig;
use Nette\Application\UI\Control;
use Nette\Application\UI\Form;

final class InvoiceFormNew extends Control
{
    /**
     * @var InvoicingConfig
     */
    private $config;

    public function __construct(InvoicingConfig $config)
    {
        $this-&gt;config = $config;
    }

    protected function createComponentInvoiceForm(): Form
    {
        $form = new Form;

        $form-&gt;addText('maturity', 'Splatnost')
            -&gt;setDefaultValue($this-&gt;config-&gt;defaultMaturity);

        return $form;
    }

    public function render()
    {
        $this-&gt;getTemplate()-&gt;render(__DIR__ . '/InvoiceForm.latte');
    }
}</code></pre>
<p>Můžeme se také zbavit vlastní implementace továrny a nahradit ji interfacem.
Nette nám pak továrnu vygeneruje samo.</p>
<pre><code class="language-php">declare(strict_types = 1);

namespace App\Forms;

interface InvoiceFormFactoryInterface
{
    public function create(): InvoiceForm;
}</code></pre>
<p>Nakonec vše zaregistrujeme v <code>config.neon</code>. Všimněte si také absence sekce <code>parameters</code>.</p>
<pre><code class="language-yaml">services:
    - App\Config\InvoicingConfig({
        defaultMaturity: 7
        pdfDirectory: %appDir%/../invoices
    })
    - App\Forms\InvoiceFormFactoryInterface</code></pre>
<p>Co na závěr? Tohle jistě není definitivní řešení. Dalo by se lecjak rozšířit.
Např. dodělat validace hodnot vstupujících do konfiguračních objektů. Tím by
však byl článek již moc složitý. Jeho pointou je ukázat alternativní přístup
předávání konfigurace službám. A jak to ve svých aplikacích děláte vy?</p>
            </div>
        </div>

        <div class="intermezzo-smaller">
            <div class="container">
                <h2>Co si o tom myslíš?</h2>
            </div>
        </div>

        <div class="container">
<div id="disqus_thread"></div>

<script type="text/javascript">
    var disqus_config = function () {
        this.language = "cs"
    };

    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');

        s.src = '//' + "pehapkari" + '.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
        </div>

        <br>
    </div>

    <script src="/assets/prism/prism.js"></script>
    <script id="dsq-count-scr" src="https://pehapkari.disqus.com/count.js" async defer></script>

<script>
    ga=function(){ ga.q.push(arguments) };
    ga.q=[];
    ga.l=+new Date;
    ga('create', "UA-89860072-1", 'auto');
    ga('send','pageview');
</script>
<script async defer src="https://www.google-analytics.com/analytics.js"></script>
<script>
    !function(f,b,e,v,n,t,s){ if(f.fbq)return;n=f.fbq=function(){ n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
            document,'script','https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', "201338863559186");
    fbq('track', 'PageView');
</script>
    </body>
</html>
